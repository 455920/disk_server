<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>网络磁盘系统</title>
        		<style>


   .menu {
	    width: 150px;
	    background-color: whitesmoke;
	    position: absolute;
	    display: none;
	   	text-align: center;
	  	boder-top-left-radius: 30px;
		boder-top-right-radius: 30px;
		boder-bottom-left-radius: 30px;
		boder-bottom-right-radius: 30px;
    }

   .menu_item{
        width: 100%;
	   	float: left;
	   	margin: 0 auto;
		border-top:1px solid gray;
		border-left:1px solid gray;
		border-right:1px solid gray;
		border-bottom:1px solid gray;
	    background-color: whitesmoke;
	   	  	boder-top-left-radius: 30px;
		boder-top-right-radius: 30px;
		boder-bottom-left-radius: 30px;
		boder-bottom-right-radius: 30px;
    }

   .left_guide_line {
	width: 100%;
	height: 1px;
	   text-align: center;
}

   .content {
	text-align: center;

	width: 400px;
	height: auto;
	background-color: darkgray;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
}


button{
	font-family: '楷体';
}

span{
	font-family: '楷体';
}

p{
	font-family: '楷体';
}
label{
	font-family: '楷体';
}

.list {
	height: 540px;
	width: 100%;
	background-color: white;
	overflow: scroll;
	overflow-x: hidden;
	float: left;
	border-top:1px solid gray;
	border-left:1px solid gray;
	border-right:1px solid gray;
	border-bottom:1px solid gray;
}


.item {
	width: 100%;
	height: 50px;
	background-color: white;
	margin: 0px 0px 0px 0px;
	border-top:1px solid olivedrab;
	border-bottom:1px solid olivedrab;
}

.home_content {
	width: 100%;
	height: 100%;
	background-color: white;
}

.left_guide {
	width: 10%;
	height: 100%;
	background-color: white;
	text-align: center;
	float: left;
	margin: 0px 0px 0px 0px;
}

.left_guide_item {
	width: 100%;
	height: 80px;
	background-color: white;
	text-align: center;
}

.right_guide {
	float: left;
	width: 90%;
	height: 100%;
}

.list_word {
	 display: inline-block;
	 float: left;
}

.head_guide {
	width: 100%;
	height: 20%;
}


.link-top {
	width: 100%;
	height: 1px;
	border-top: solid #ACC0D8 1px;
	float: left;
	margin: 20px 0px 5px 0px;
}

.black_overlay{
    display: none;
    position: absolute;
    top: 0%;
    left: 0%;
    width: 100%;
    height: 100%;
    background-color: black;
    z-index:1001;
    -moz-opacity: 0.8;
    opacity:.80;
    filter: alpha(opacity=88);
}

.white_content {
    display: none;
    position: absolute;
    top: 25%;
    left: 25%;
    width: 55%;
    height: 10%;
    padding: 20px;
    border: 10px solid orange;
    background-color: white;
    z-index:1002;
    overflow: auto;
}

.ft {
	display: none;
}
		.myFileUpload
{
	display: block;
	width: 100%	;
	height: 25px;
	opacity: 0.5;;
}

.div_progress{
	width: 100%;
	height: 5px;
	float: left;
	margin: 0px 0px 5px 0px;
}

.progress-bar {
	border: 1px solid #ACC0D8;
}
.progress {
	width: 0;
	background: #DEDEDE;
	height: 5px;
}
		</style>
	</head>



	<body style="overflow-y: hidden; overflow-x: hidden">
		<div class="menu" id="menu">
			<buttun class="menu_item" id="btn_create_folder"><p>新建目录</p></buttun>
			<buttun class="menu_item" id="btn_create_file"><p>新建文件</p></buttun>
			<buttun class="menu_item" id="btn_refresh"><p>刷新</p></buttun>
			<buttun class="menu_item" id="btn_cancel"><p>取消</p></buttun>
		</div>
		<div class='head_guide'>
			<div class="div_progress">
				<div class="progress-bar">
					<div class="progress"  id="progress"></div>
				</div>
			</div>
			<div  style="width: 80%; float: left; ">
				<p style="font-family: '楷体'; font-size: 30px">网络磁盘系统</p>
			</div>
			<form action="/logout/" method="get" id="logout">
				<div style="width: 10%; float: left">
					<div style="margin: 50px 0px 0px 0px">
					<Label style="color: red; "><span style="font-family: '楷体';">当前登录:</span></Label>
					<Label id="nickname" style="margin: auto; font-family: '楷体';">{{ nickname }}</Label>
					</div>
				</div>
				<div style="width: 10%; float: left">
					<div style="margin: 50px 0px 0px 0px">
					<input type="submit" value="注销登录" style="margin: 0px 0px 0px 20px;  font-family: '楷体';">
					</div>
				</div>
			</form>

			<div class="link-top"></div>

		</div>

		<div style="width: 100%; height: 80%">
			<div class="left_guide" >
				<div class="left_guide_item" id="guide_all_file" style="color: #6600FF;"><p style="margin: auto; padding: 40px;">全部文件</p></div>
				<div class="left_guide_line">
					<div style="width: 75%;border-top: solid #ACC0D8 1px;
	 				margin: 0 auto"></div>
				</div>
				<div class="left_guide_item" id="guide_image"><p style="margin: auto; padding: 40px;">图片</p></div>
				<div class="left_guide_line">
					<div style="width: 75%;border-top: solid #ACC0D8 1px;
	 				margin: 0 auto"></div>
				</div>
				<div class="left_guide_item" id="guide_doc"><p style="margin: auto; padding: 40px;">文档</p></div>
				<div class="left_guide_line">
					<div style="width: 75%;border-top: solid #ACC0D8 1px;
	 				margin: 0 auto"></div>
				</div>
				<div class="left_guide_item" id="guide_video"><p style="margin: auto; padding: 40px;">视频</p></div>
				<div class="left_guide_line">
					<div style="width: 75%;border-top: solid #ACC0D8 1px;
	 				margin: 0 auto"></div>
				</div>
				<div class="left_guide_item" id="guide_music"><p style="margin: auto; padding: 40px;">音乐</p></div>
				<div class="left_guide_line">
					<div style="width: 75%;border-top: solid #ACC0D8 1px;
	 				margin: 0 auto"></div>
				</div>
				<div class="left_guide_item" id="guide_other"><p style="margin: auto; padding: 40px;">其他</p></div>
								<div class="left_guide_line">
					<div style="width: 75%;border-top: solid #ACC0D8 1px;
	 				margin: 0 auto"></div>
				</div>
				<div class="left_guide_item" id="guide_share"><p style="margin: auto; padding: 40px;">我的分享</p></div>
			</div>
			<div class="right_guide">
					<div style="background-color: white; width: 100%; height: 30px " id="right_guide_all_file_1">
						<div style="width: 15%; float: left;">
							<input type="file" id="ipt-file" name="files"/>
						</div>
						<div style="width: 4%; float: left;">
							<button type="button" id="btn-upload">上传</button>
						</div>


						<div style="width: 6%; float: left;">
							<button id="btn_new_folder" >新建目录</button>
						</div>
						<div style="width: 7%; float: left;">
							<button id="btn_new_file" >新建文件</button>
						</div>
					</div>
					<div style="background-color: white; width: 100%; height: 40px" id="right_guide_all_file_2">
						<div style="width: 7%; float: left;">
							<button id="btn_last_folder">返回上一级</button>
						</div>
						<div style="width: 10%; float: left;">
							<button id="btn_root_folder">返回根目录</button>
						</div>
						<div style="width: 60% ;float: left;">
							<span id="cur_path"  style="text-decoration: underline; display: none">/</span>
							<span id="cur_path_show"  style="text-decoration: underline">/</span>
						</div>

					</div>
					<div style="background-color: darkgrey; width: 100%">
						<label class="list_word" id="filename" style="width: 30%; float: left;">文件名</label>
						<label class="list_word" id="size" style="width: 30%;  float: left;">文件大小</label>
						<div style="width: 20%;float: right; ">
							<span style="margin: 0px 0px 0px 100px">
							已经加载
							<span id="file_load_count"  >0</span>
							个文件
							</span>
						</div>
					</div>
					<div class="home_content" id="home_content">
						<div class="list">
							<div class="list_items">
							</div>
						</div>
					</div>
			</div>

		</div>




		<div id="client" class="white_content">文件太大，请在客户端里下载:

				<a id='downloadlink' href="#" style="margin: 0 140px 0 0;">客户端下载链接</a>
				<a href="javascript:void(0)" onclick="document.getElementById('client').style.display='none';document.getElementById('fade').style.display='none'">点这里关闭本窗口</a>
		</div>

		<div id="light" class="white_content">点击链接下载文件:

			<a id='downloadlink' href="#" style="margin: 0 140px 0 0;">下载链接</a>
			<a href="javascript:void(0)" onclick="document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">点这里关闭本窗口</a>

		</div>
		<div id="fade" class="black_overlay">
		</div>
	</body>
	<script>
		var folder_stack = [];
		var cur_guide_id = 'guide_all_file';
		var cur_category_id = ''
		folder_stack.push("/");

		function create_folder(folder_name)
		{
				var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
				var url = '/create_folder'+folder_stack[folder_stack.length-1] + '?folder_name=' + folder_name;
				httpRequest.open('GET', url, true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
				httpRequest.send();//第三步：发送请求  将请求参数写在URL中
				/**
				 * 获取数据后的处理程序
				 */
				httpRequest.onreadystatechange = function () {
					if (httpRequest.readyState == 4 && httpRequest.status == 200) {
					    if (httpRequest.responseText != '0')
						{
							alert('创建目录失败，有重名文件或者目录！')
						}

		     			list_show(folder_stack[folder_stack.length-1]);
					}
				};
		}

		function create_file(file_name)
		{
				var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
				var url = '/create_file'+folder_stack[folder_stack.length-1] + '?file_name=' + file_name;
				httpRequest.open('GET', url, true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
				httpRequest.send();//第三步：发送请求  将请求参数写在URL中
				/**
				 * 获取数据后的处理程序
				 */
				httpRequest.onreadystatechange = function () {
					if (httpRequest.readyState == 4 && httpRequest.status == 200) {
					    if (httpRequest.responseText != '0')
						{
							alert('创建文件失败，有重名文件或者目录！')
						}

		     			list_show(folder_stack[folder_stack.length-1]);
					}
				};
		}

		function delete_file(filename)
		{
			var r = confirm("确定删除吗");
			if(r)
			{
			    var url = ''
				var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
				if (cur_guide_id != 'guide_all_file')
				    url = '/delete/'  + filename;
				else
					url = '/delete' + folder_stack[folder_stack.length-1] + filename;
				httpRequest.open('GET', url, true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
				httpRequest.send();//第三步：发送请求  将请求参数写在URL中
				/**
				 * 获取数据后的处理程序
				 */
				httpRequest.onreadystatechange = function () {
					if (httpRequest.readyState == 4 && httpRequest.status == 200) {
						if (cur_guide_id != 'guide_all_file')
							category_list_show(cur_category_id);
						else
							list_show(folder_stack[folder_stack.length-1]);
					}
				};
			}
		}

		function share_file(filename)
		{
				var r = confirm("你确定分享吗");
				if(r)
				{
					var url = ''
					var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
					url = '/create_share' + folder_stack[folder_stack.length-1] + filename + '?file_name=' + filename ;
					httpRequest.open('GET', url, true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
					httpRequest.send();//第三步：发送请求  将请求参数写在URL中
					/**
					 * 获取数据后的处理程序
					 */
					httpRequest.onreadystatechange = function () {
						if (httpRequest.readyState == 4 && httpRequest.status == 200) {
							if(httpRequest.responseText == '1')
							{
							    alert('分享失败, 请刷新页面重试');
							}
							else
							{
							    alert('分享成功，请复制链接给好友:' + window.location.href + 'share/'+ httpRequest.responseText);
							}
						}
					};
				}
		}

		function unshare_file(share_key)
		{
				var r = confirm("你确定取消分享吗");
				if(r)
				{
					var url = ''
					var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
					url = '/cancel_share/' + share_key;
					httpRequest.open('GET', url, true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
					httpRequest.send();//第三步：发送请求  将请求参数写在URL中
					/**
					 * 获取数据后的处理程序
					 */
					httpRequest.onreadystatechange = function () {
						if (httpRequest.readyState == 4 && httpRequest.status == 200) {
							if(httpRequest.responseText == '1')
							{
							    alert('取消失败, 请刷新页面重试');
							}
							else
							{
							    alert('已经取消分享');
							}
							share_list_show();
						}
					};
				}
		}

		function category_list_show(id) {
            var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
            httpRequest.open('GET', '/category/' + id, true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
            httpRequest.send();//第三步：发送请求  将请求参数写在URL中
            /**
             * 获取数据后的处理程序
             */
            httpRequest.onreadystatechange = function () {
                if (httpRequest.readyState == 4 && httpRequest.status == 200) {
                    var list_items = document.getElementsByClassName('list_items')[0];
                    console.log(list_items);
                    var json = httpRequest.responseText;//获取到json字符串，还需解析
                    var items_html = '';
                    obj = JSON.parse(json);
                    files = obj.file_list;
                    document.getElementById('file_load_count').innerHTML = obj.file_count;
                    for (var i = 0; i < files.length; i++) {
                        var item_html = '';
                        item_html = '<div class=\"item\"> 	\<' +
                            'img src=\"' + files[i]['file_icon'] + '\" class=\"list_word\">\<' +
                            'a href=\"' + '/preview/' + files[i]['file_path'] + '\"  target=\"_blank\">\<' +
                            'label class=\"list_word\" id=\"filename\" style=\"width: 30%;\">' + files[i]['file_path'] + '</label>\<' +
                            '/a> \<' +
                            'label class=\"list_word\"  style=\"width: 30%;\">' + files[i]['file_size_show'] + '</label>\<' +
							'label class=\"list_word\" id=\"isfolder\" style=\"display: none\">' + files[i]['is_folder'] + '</label>\<' +
                            'label class=\"list_word\" id=\"filesize\" style=\"display: none\">' + files[i]['file_size'] + '</label>\<' +
                            'div style=\"width: 30%; float: left; \" id=\"item_btns\">\<' +
                            'button class=\"ft\" id=\'btn_share\' style=\"float: right;\">分享</button>\ ' +
                            '<button class=\"ft\" id=\'btn_download\' style=\"float: right;\">下载</button>\ ' +
                            '<button class=\"ft\" id=\'btn_delete\'style=\"float: right;\">删除</button></div>\<' +
                            '/div>';
                        items_html = items_html + item_html;
                    }

                    list_items.innerHTML = items_html;
                    <!--var obj = JSON.parse(filelist)-->
                    bind_item()
                }
            }
        }

        function share_list_show(){
			var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
            httpRequest.open('GET', '/share_list/', true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
            httpRequest.send();//第三步：发送请求  将请求参数写在URL中
            /**
             * 获取数据后的处理程序
             */
            httpRequest.onreadystatechange = function () {
                if (httpRequest.readyState == 4 && httpRequest.status == 200) {
                    var list_items = document.getElementsByClassName('list_items')[0];
                    console.log(list_items);
                    var json = httpRequest.responseText;//获取到json字符串，还需解析
                    var items_html = '';
                    obj = JSON.parse(json);
                    files = obj.file_list;
                    document.getElementById('file_load_count').innerHTML = obj.file_count;
                    for (var i = 0; i < files.length; i++) {
                        var item_html = '';
                        item_html = '<div class=\"item\"> 	\<' +
                            'img src=\"' + files[i]['file_icon'] + '\" class=\"list_word\">\<' +
                            'label class=\"list_word\" id=\"filename\" style=\"width: 30%;\">' + files[i]['file_name'] + '</label>\<' +
							'label class=\"list_word\" id=\"isfolder\" style=\"display: none\">' + files[i]['is_folder'] + '</label>\<' +
                            'label class=\"list_word\" id=\"sharekey\" style=\"display: none\">' + files[i]['share_key'] + '</label>\<' +
							'label class=\"list_word\" id=\"sharelink\" style=\"display: none\">' + window.location.href + 'share/'+ files[i]['share_key'] + '</label>\<' +
                            'button class=\"ft\" id=\'btn_cancel_share\' style=\"float: right;\">取消分享</button></div>';
                        items_html = items_html + item_html;
                    }

                    list_items.innerHTML = items_html;
                    <!--var obj = JSON.parse(filelist)-->
					share_bind_item();
                }
            }
		}

		function share_bind_item() {
            var items = document.getElementsByClassName('item');
            console.log(items);
            for (var i = 0; i < items.length; i++) {
                (function (i) {
                    var filename = items[i].querySelector('#filename').innerHTML;
					var share_key = items[i].querySelector('#sharekey').innerHTML;
                    var btn_cancel_share = items[i].querySelector('#btn_cancel_share');
                    var isfolder = items[i].querySelector('#isfolder');
					var sharelink = items[i].querySelector('#sharelink');

                    <!--鼠标悬浮-->
                    items[i].addEventListener('mouseover', function (event) {
                        this.style.backgroundColor = 'white';
                        this.style.height = '60px';
                        this.querySelector('#btn_cancel_share').style.display = 'block';
						this.querySelector('#sharelink').style.display = 'block';

                    });

                    <!--鼠标离开-->
                    items[i].addEventListener('mouseout', function (event) {
                        this.style.backgroundColor = 'white';
                        this.style.height = '50px';
                        this.querySelector('#btn_cancel_share').style.display = 'none';
                        this.querySelector('#sharelink').style.display = 'none';
                    });

                    btn_cancel_share.addEventListener('click', function(event){
                        unshare_file(share_key);
					})

                })(i);
            }
        }

		function bind_item(){
		    var items = document.getElementsByClassName('item');

			console.log(items);
			for(var i = 0; i < items.length; i++) {
				(function(i){
				    var filename = items[i].querySelector('#filename').innerHTML;
				var filesize = items[i].querySelector('#filesize').innerHTML;

				var btn_share = items[i].querySelector('#btn_share');
				var btn_download = items[i].querySelector('#btn_download');
				var isfolder = items[i].querySelector('#isfolder');
				var btn_delete = items[i].querySelector('#btn_delete');


				if (isfolder.innerHTML == "1") {

 					items[i].addEventListener('dblclick', function(event){
 					    folder_stack.push(cur_path.innerHTML + filename + '/' );
 					    list_show(cur_path.innerHTML + filename + '/' )
					})
				}

				<!--分享按钮-->
				btn_share.addEventListener('click', function(event) {
					share_file(filename);
				});

				<!--鼠标悬浮-->
				items[i].addEventListener('mouseover', function(event) {
					this.style.backgroundColor = 'white';
					this.style.height = '60px';
					if (isfolder.innerHTML == "0") {

						this.querySelector('#btn_share').style.display = 'block'
						this.querySelector('#btn_download').style.display = 'block'
						this.querySelector('#btn_delete').style.display = 'block'
					}
					else
					{
						this.querySelector('#btn_share').style.display = 'block';
						this.querySelector('#btn_delete').style.display = 'block';
					}

				});

				<!--鼠标离开-->
				items[i].addEventListener('mouseout', function(event) {
					this.style.backgroundColor = 'white';
					this.style.height = '50px';
						this.querySelector('#btn_share').style.display = 'none';
					this.querySelector('#btn_download').style.display = 'none';
					this.querySelector('#btn_delete').style.display = 'none';

				});

				<!--下载按钮-->
				btn_download.addEventListener('click', function(event) {
				    <!-- 限制网页大文件的下载 20M-->
					if (filesize < 1024*1024*20) {
                        light = document.getElementById('light');
                        light.style.display = 'block';

                        if (cur_guide_id != 'guide_all_file')
                        	light.querySelector('#downloadlink').href = '/download/' + filename;
                        else
                            light.querySelector('#downloadlink').href = '/download' + folder_stack[folder_stack.length-1] + filename;

                        document.getElementById('fade').style.display = 'block';
                    }
                    else
					{
					    client = document.getElementById('client');
                        client.style.display = 'block';
                        client.querySelector('#downloadlink').href = '#';
                        document.getElementById('fade').style.display = 'block';
					}


				});

				//删除按钮
				btn_delete.addEventListener('click', function(event) {
					delete_file(filename)
				})
				})(i)

			}
		}


		function list_show(path) {
		    if(path == '/') {
		        btn_last_folder.style.display = 'none';
		        btn_root_folder.style.display = 'none';
                cur_path_show.innerHTML = '全部文件';
            }
		    else {
		         btn_last_folder.style.display = 'block';
		         btn_root_folder.style.display = 'block';
                cur_path_show.innerHTML = path;
            }
		    cur_path.innerHTML = path;
		    var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
			httpRequest.open('GET', '/list' + path, true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
			httpRequest.send();//第三步：发送请求  将请求参数写在URL中
			/**
			 * 获取数据后的处理程序
			 */
			httpRequest.onreadystatechange = function () {
				if (httpRequest.readyState == 4 && httpRequest.status == 200) {
				    var list_items =  document.getElementsByClassName('list_items')[0];
				    console.log(list_items);
					var json = httpRequest.responseText;//获取到json字符串，还需解析
					var items_html = '';
					obj = JSON.parse(json);
					files = obj.file_list;
					document.getElementById('file_load_count').innerHTML = obj.file_count;
					for(var i = 0 ; i < files.length ; i++)
					{
					    var item_html = '';
					    if( files[i]['is_folder'] == '0') {
                            item_html = '<div class=\"item\"> 	\<' +
                                'img src=\"' + files[i]['file_icon'] + '\" class=\"list_word\">\<' +
								'a href=\"'+ '/preview' + folder_stack[folder_stack.length-1] + files[i]['file_name']+'\"  target=\"_blank\">\<' +
                                'label class=\"list_word\" id=\"filename\" style=\"width: 30%;\">' + files[i]['file_name'] + '</label>\<' +
								'/a> \<' +
                                'label class=\"list_word\"  style=\"width: 30%;\">' + files[i]['file_size_show'] + '</label>\<' +
                                'label class=\"list_word\" id=\"isfolder\" style=\"display: none\">' + files[i]['is_folder'] + '</label>\<' +
                                'label class=\"list_word\" id=\"filesize\" style=\"display: none\">' + files[i]['file_size'] + '</label>\<' +
                                'div style=\"width: 30%; float: left; \" id=\"item_btns\">\<' +
                                'button class=\"ft\" id=\'btn_share\' style=\"float: right;\">分享</button>\ ' +
                                '<button class=\"ft\" id=\'btn_download\' style=\"float: right;\">下载</button>\ ' +
                                '<button class=\"ft\" id=\'btn_delete\'style=\"float: right;\">删除</button></div>\<' +
                                '/div>';
                        }
                        else{
                            item_html = '<div class=\"item\"> 	\<' +
                                'img src=\"' + files[i]['file_icon'] + '\" class=\"list_word\">\<' +
                                'label class=\"list_word\" id=\"filename\" style=\"width: 30%;\">' + files[i]['file_name'] + '</label> \<' +
                                'label class=\"list_word\"  style=\"width: 30%;\">' + '-'+ '</label>\<' +
                                'label class=\"list_word\" id=\"isfolder\" style=\"display: none\">' + files[i]['is_folder'] + '</label>\<' +
                                'label class=\"list_word\" id=\"filesize\" style=\"display: none\">' + files[i]['file_size'] + '</label>\<' +
                                'div style=\"width: 30%; float: left; \" id=\"item_btns\">\<' +
                                'button class=\"ft\" id=\'btn_share\' style=\"float: right;\">分享</button>\ ' +
                                '<button class=\"ft\" id=\'btn_download\' style=\"float: right;\">下载</button>\ ' +
                                '<button class=\"ft\" id=\'btn_delete\'style=\"float: right;\">删除</button></div>\<' +
                                '/div>';
                        }

						items_html = items_html + item_html;
					}

					list_items.innerHTML = items_html;
					<!--var obj = JSON.parse(filelist)-->
					bind_item()
				}
			};

        }

		function change_guide_()
		{
			var right_guide_all_file_1 = document.getElementById('right_guide_all_file_1');
            var right_guide_all_file_2 = document.getElementById('right_guide_all_file_2');
            if (cur_guide_id == 'guide_all_file')
			{
				right_guide_all_file_1.style.display = 'block';
				right_guide_all_file_2.style.display = 'block';
				document.querySelector('#btn_create_folder').style.display = 'block';
				document.querySelector('#btn_create_file').style.display = 'block';
			}
			else
			{
				right_guide_all_file_1.style.display = 'none';
				right_guide_all_file_2.style.display = 'none';
				document.querySelector('#btn_create_folder').style.display = 'none';
				document.querySelector('#btn_create_file').style.display = 'none';
			}
		}

		function change_guide(guide_name, the_id) {
            console.log(guide_name);
            var left_guide_items = document.getElementsByClassName('left_guide_item');
            for (var i = 0; i < left_guide_items.length; i++) {
                (function (i) {
                    left_guide_items[i].style.color = 'black';
                })(i);
            }


            if (the_id == 'guide_all_file') {


				list_show(folder_stack[folder_stack.length-1]);
            }
            else if (the_id == 'guide_image')
            {
				cur_category_id = '1';
				 category_list_show('1');

			}
			else if(the_id == 'guide_doc')
			{
				cur_category_id = '2';
				category_list_show('2');
			}
			else if(the_id == 'guide_video')
			{
					cur_category_id = '3';
				category_list_show('3');
			}
			else if(the_id == 'guide_music')
			{
					cur_category_id = '4';
				category_list_show('4');
			}
			else if(the_id == 'guide_other')
			{
				cur_category_id = '5';
				category_list_show('5');
			}
			else <!--guide_share-->
			{
				share_list_show();
			}
			change_guide_()
		}




		function init(){
		    		document.getElementById('btn_last_folder').addEventListener('click',function(){
			if (folder_stack.length != 1)
			{
				folder_stack.pop();
			}
			list_show(folder_stack[folder_stack.length-1])
		});
		document.getElementById('btn_root_folder').addEventListener('click',function(){
			folder_stack = ['/'];

			list_show(folder_stack[folder_stack.length-1])
		});


		var content = document.getElementById("home_content");
        content.oncontextmenu = function (ev) {
            //阻止鼠标的默认事件
            ev.preventDefault();        //做一些兼容性的处理
            var ev = ev || event;
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            menu.style.display = "block";
            menu.style.left = ev.clientX + "px";
            //当滑动滚动条时也能准确获取菜单位置
            menu.style.top = ev.clientY + scrollTop + "px";
            // return false;
        };

		var menu =  document.getElementById("menu");
        menu_items = menu.querySelectorAll('.menu_item');
        for(var i = 0 ; i < menu_items.length; i++)
		{
			 console.log(menu_items[i]);
			   menu_items[i].addEventListener('mouseover', function(event) {
							this.style.backgroundColor = 'white';
				});

				menu_items[i].addEventListener('mouseout', function(event) {
					this.style.backgroundColor = 'whitesmoke';
				});
		}
		menu.querySelector('#btn_cancel').addEventListener('click', function(event){
		     menu.style.display = "none";
		});

		menu.querySelector('#btn_refresh').addEventListener('click', function(event){
		     menu.style.display = "none";
		     if (cur_guide_id == 'guide_all_file')
		        list_show(folder_stack[folder_stack.length-1]);
		     else if(cur_guide_id == 'guide_share')
		         share_list_show();
			 else
			 	category_list_show(cur_category_id);
		});

		menu.querySelector('#btn_create_folder').addEventListener('click', function(event){
		     menu.style.display = "none";
			 var name = prompt("目录名:", "新建文件夹");
			     if (name)//如果返回的有内容
				{
				    create_folder(name)

				}

		});

		menu.querySelector('#btn_create_file').addEventListener('click', function(event){
		     menu.style.display = "none";
			 var name = prompt("文件名:", "新建文件.txt");
			     if (name)//如果返回的有内容
				{
				    create_file(name)
				}

		});

		 document.getElementById('btn_new_folder').addEventListener('click', function(event){
			 var name = prompt("目录名:", "新建文件夹");
			     if (name)//如果返回的有内容
				{
				    create_folder(name)

				}
		 });

		document.getElementById('btn_new_file').addEventListener('click', function(event){
			 var name = prompt("目录名:", "新建文件.txt");
			     if (name)//如果返回的有内容
				{
				    create_file(name)

				}
		 });


		var left_guide_items = document.getElementsByClassName('left_guide_item');
		for(var i = 0 ; i <   left_guide_items.length ; i++)
		{
			(function(i){
			    left_guide_items[i].addEventListener('mouseover', function(event){
					this.style.backgroundColor = '#C0C0C0';
				})

				left_guide_items[i].addEventListener('mouseout', function(event){
					this.style.backgroundColor = 'white';
				})

				left_guide_items[i].addEventListener('click', function(event){
				    cur_guide_id = left_guide_items[i].id; <!-- 更新last_guide_id -->
					change_guide(left_guide_items[i].querySelector('p').innerHTML, left_guide_items[i].id);
					this.style.color = '#6600FF';

				})
			})(i);
		}

		var btn_import_file = document.getElementById('ipt-file');
		btn_import_file.addEventListener('change', function() {
			var t_files = this.files;
			console.log(t_files);
			var str = '';
			for (var i = 0, len = t_files.length; i < len; i++) {
				console.log(t_files[i].size / 1024 / 1024 + 'M');
				//文件大于20M就无法上传
				if(t_files[i].size / 1024 / 1024 > 20)
				{
					this.value = '';
					this.outerHTML = this.outerHTML;
					alert('文件太大，请使用客户端上传');
				}
			};
		}, false);
		}

		init();
		list_show("/");

		var button = document.querySelector("#btn-upload"),
			input = document.querySelector("#ipt-file"),
			progress = document.querySelector("#progress"),
			info = document.querySelector("#info");

		var upload = function() {
					if (input.files.length === 0) {
						console.log("未选择文件");
						return;
					}

					var formData = new FormData();
					formData.append("file", input.files[0]);

					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function() {
						if (xhr.readyState === 4 && xhr.status === 200) {
							console.log(xhr.responseText);
							if (xhr.responseText == '0')
							    alert('上传成功');
							else if(xhr.responseText == '2')
							    alert('上传失败, 文件名已存在');
							else
							    alert('上传失败，未知原因');

							list_show(folder_stack[folder_stack.length-1]);
						}
					};

					xhr.upload.addEventListener("progress", function(event) {
						if(event.lengthComputable){
							progress.style.width = Math.ceil(event.loaded * 100 / event.total) + "%";
						}
					}, false);

					console.log("./upload" + folder_stack[folder_stack.length-1]);
					xhr.open("POST", "./upload" + folder_stack[folder_stack.length-1]);
					xhr.send(formData);
		};

	button.addEventListener("click", upload, false);


	</script>

</html>